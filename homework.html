<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QG AI ËÆ≠ÁªÉËê• - ‰Ωú‰∏öÁõëÊéßÁ≥ªÁªü</title>
    <style>
        :root {
            /* Light Mode (ÈªòËÆ§) */
            --qg-cyan: #00d4ff;
            --qg-blue: #0066ff;
            --qg-purple: #8b5cf6;
            --qg-pink: #ec4899;
            --qg-bg: #f8fafc;
            --qg-surface: #ffffff;
            --qg-border: rgba(0, 102, 255, 0.15);
            --qg-text: #1e293b;
            --qg-text-dim: #64748b;
            --qg-shadow: rgba(0, 0, 0, 0.1);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --card-hover-shadow: rgba(0, 102, 255, 0.15);
            --gradient-start: rgba(0, 212, 255, 0.05);
            --gradient-end: rgba(139, 92, 246, 0.05);
            --bg-pattern: rgba(0, 102, 255, 0.03);
        }

        [data-theme="dark"] {
            --qg-bg: #050714;
            --qg-surface: rgba(15, 23, 42, 0.95);
            --qg-border: rgba(0, 212, 255, 0.3);
            --qg-text: #e2e8f0;
            --qg-text-dim: #94a3b8;
            --qg-shadow: rgba(0, 0, 0, 0.5);
            --card-hover-shadow: rgba(0, 212, 255, 0.3);
            --gradient-start: rgba(0, 212, 255, 0.1);
            --gradient-end: rgba(139, 92, 246, 0.1);
            --bg-pattern: rgba(0, 212, 255, 0.03);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--qg-bg);
            color: var(--qg-text);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background 0.5s ease, color 0.5s ease;
        }

        /* Âä®ÊÄÅËÉåÊôØ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 50%, var(--gradient-start) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, var(--gradient-end) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(0, 102, 255, 0.05) 0%, transparent 50%);
            animation: bgPulse 15s ease-in-out infinite alternate;
            z-index: -1;
            transition: opacity 0.5s ease;
        }

        @keyframes bgPulse {
            0% { opacity: 0.5; transform: scale(1); }
            100% { opacity: 0.8; transform: scale(1.05); }
        }

        /* ÁΩëÊ†ºËÉåÊôØ */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(var(--bg-pattern) 1px, transparent 1px),
                linear-gradient(90deg, var(--bg-pattern) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
            transition: opacity 0.5s ease;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Header - Á¥ßÂáëËÆæËÆ° */
        .header {
            background: linear-gradient(135deg, var(--qg-blue) 0%, var(--qg-cyan) 50%, var(--qg-purple) 100%);
            padding: 32px 40px;
            border-radius: 20px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px var(--qg-shadow);
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            animation: headerGlow 8s ease-in-out infinite;
        }

        @keyframes headerGlow {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(-20px, 20px) scale(1.1); }
        }

        .header-content {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .brand-logo {
            font-size: 40px;
            filter: drop-shadow(0 0 15px rgba(255,255,255,0.5));
            animation: logoPulse 3s ease-in-out infinite;
        }

        @keyframes logoPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .brand-text h1 {
            font-size: 32px;
            font-weight: 800;
            color: white;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.6);
            letter-spacing: -0.5px;
        }

        .brand-text .subtitle {
            font-size: 13px;
            opacity: 0.9;
            font-weight: 500;
            letter-spacing: 1.5px;
            margin-top: 4px;
        }

        /* Theme Toggle - Â∏¶Âä®Êïà */
        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            padding: 8px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: white;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .theme-toggle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .theme-toggle:hover::before {
            width: 200px;
            height: 200px;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .theme-icon {
            font-size: 18px;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            z-index: 1;
        }

        .theme-toggle:hover .theme-icon {
            transform: rotate(180deg) scale(1.1);
        }

        .theme-text {
            position: relative;
            z-index: 1;
        }

        /* Stats - ÈáçË¶ÅÊÄßÂàÜÁ∫ß */
        .stats-bar {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1.5fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--qg-surface);
            border: 1px solid var(--qg-border);
            padding: 20px 24px;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px var(--qg-shadow);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--qg-cyan) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--qg-cyan);
            box-shadow: 0 8px 24px var(--card-hover-shadow);
        }

        .stat-card:hover::before {
            opacity: 0.05;
        }

        .stat-content {
            position: relative;
            z-index: 1;
        }

        .stat-label {
            color: var(--qg-text-dim);
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--qg-cyan), var(--qg-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card:first-child .stat-value {
            font-size: 42px;
        }

        /* Toolbar */
        .toolbar {
            background: var(--qg-surface);
            border: 1px solid var(--qg-border);
            padding: 16px 20px;
            border-radius: 16px;
            margin-bottom: 24px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px var(--qg-shadow);
        }

        .toolbar-section {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        /* View Switcher - 3DÊïàÊûú */
        .view-switcher {
            display: flex;
            gap: 0;
            background: var(--qg-bg);
            padding: 4px;
            border-radius: 10px;
            border: 1px solid var(--qg-border);
            position: relative;
        }

        .view-switcher::before {
            content: '';
            position: absolute;
            width: calc(50% - 4px);
            height: calc(100% - 8px);
            background: linear-gradient(135deg, var(--qg-cyan), var(--qg-blue));
            border-radius: 8px;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 0;
            top: 4px;
            left: 4px;
            box-shadow: 0 2px 8px rgba(0, 102, 255, 0.3);
        }

        .view-switcher.table-active::before {
            transform: translateX(calc(100% + 4px));
        }

        .view-btn {
            padding: 8px 20px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 700;
            color: var(--qg-text-dim);
            transition: all 0.3s;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .view-btn.active {
            color: white;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--qg-blue), var(--qg-cyan));
            color: white;
            box-shadow: 0 2px 12px rgba(0, 102, 255, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 102, 255, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--qg-purple), var(--qg-pink));
            color: white;
            box-shadow: 0 2px 12px rgba(139, 92, 246, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-ghost {
            background: transparent;
            color: var(--qg-text);
            border: 2px solid var(--qg-border);
        }

        .btn-ghost:hover {
            border-color: var(--qg-cyan);
            color: var(--qg-cyan);
            box-shadow: 0 0 16px rgba(0, 212, 255, 0.2);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-sm {
            padding: 6px 14px;
            font-size: 12px;
        }

        /* Toggle Switch */
        .toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-wrapper span {
            font-size: 12px;
            color: var(--qg-text-dim);
        }

        .toggle {
            position: relative;
            width: 48px;
            height: 24px;
            background: var(--qg-bg);
            border: 1px solid var(--qg-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle.active {
            background: linear-gradient(135deg, var(--qg-cyan), var(--qg-blue));
            box-shadow: 0 0 16px rgba(0, 212, 255, 0.4);
        }

        .toggle-thumb {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: left 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle.active .toggle-thumb {
            left: 26px;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 24px;
        }

        .card {
            background: var(--qg-surface);
            border: 1px solid var(--qg-border);
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 2px 12px var(--qg-shadow);
            transition: box-shadow 0.3s;
        }

        .card:hover {
            box-shadow: 0 4px 20px var(--qg-shadow);
        }

        .card-header {
            padding: 18px 24px;
            border-bottom: 1px solid var(--qg-border);
            font-weight: 800;
            font-size: 16px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
        }

        .card-body {
            padding: 24px;
        }

        /* Sidebar Cards - Á¥ßÂáëÂåñ */
        .sidebar-card {
            margin-bottom: 16px;
        }

        .sidebar-card .card-header {
            padding: 14px 18px;
            font-size: 14px;
        }

        .sidebar-card .card-body {
            padding: 18px;
        }

        /* View Container - 3D Flip */
        .view-container {
            perspective: 2000px;
            min-height: 500px;
        }

        .view-wrapper {
            position: relative;
            width: 100%;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform-style: preserve-3d;
        }

        .view-wrapper.flipping {
            transform: rotateY(180deg);
        }

        .students-grid, .table-view {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .table-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            transform: rotateY(180deg);
            opacity: 0;
            transition: opacity 0.4s;
        }

        .view-wrapper.flipping .table-view {
            opacity: 1;
        }

        .view-wrapper.flipping .students-grid {
            opacity: 0;
        }

        /* Student Cards */
        .students-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(420px, 1fr));
            gap: 20px;
        }

        .student-card {
            background: var(--qg-surface);
            border: 1px solid var(--qg-border);
            border-radius: 14px;
            padding: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .student-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--gradient-start), transparent);
            transition: left 0.6s;
        }

        .student-card:hover::before {
            left: 100%;
        }

        .student-card:hover {
            transform: translateY(-6px);
            border-color: var(--qg-cyan);
            box-shadow: 0 12px 32px var(--card-hover-shadow);
        }

        .student-card.updated {
            border-left: 3px solid var(--warning);
            animation: pulseWarning 2s ease-in-out infinite;
        }

        @keyframes pulseWarning {
            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
            50% { box-shadow: 0 0 20px 5px rgba(245, 158, 11, 0.2); }
        }

        .student-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .student-name {
            font-size: 20px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--qg-cyan), var(--qg-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 6px;
        }

        .student-repo-link {
            font-size: 12px;
            color: var(--qg-cyan);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.3s;
        }

        .student-repo-link:hover {
            color: var(--qg-blue);
            transform: translateX(4px);
        }

        .badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .student-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px;
            background: var(--qg-bg);
            border-radius: 10px;
            border: 1px solid var(--qg-border);
        }

        .meta-item {
            font-size: 12px;
        }

        .meta-label {
            color: var(--qg-text-dim);
            margin-bottom: 4px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .meta-value {
            color: var(--qg-text);
            font-weight: 700;
            font-size: 13px;
        }

        .student-scores {
            margin-bottom: 16px;
        }

        .scores-header {
            font-size: 12px;
            font-weight: 700;
            color: var(--qg-text-dim);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .avg-score {
            padding: 4px 14px;
            background: linear-gradient(135deg, var(--qg-cyan), var(--qg-purple));
            color: white;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 800;
            box-shadow: 0 2px 8px rgba(0, 212, 255, 0.3);
        }

        .score-items {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .score-item {
            text-align: center;
        }

        .score-item-label {
            font-size: 10px;
            color: var(--qg-text-dim);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .score-item-input {
            width: 100%;
            padding: 8px 4px;
            border: 2px solid var(--qg-border);
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            font-weight: 800;
            background: var(--qg-bg);
            color: var(--qg-cyan);
            transition: all 0.3s;
        }

        .score-item-input:focus {
            outline: none;
            border-color: var(--qg-cyan);
            box-shadow: 0 0 12px rgba(0, 212, 255, 0.3);
            transform: scale(1.05);
        }

        .score-item-input.changed {
            border-color: var(--warning);
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
            animation: scoreChange 0.5s ease-out;
        }

        @keyframes scoreChange {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .student-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        /* Table View */
        .table-container {
            overflow-x: auto;
            max-height: 65vh;
            border-radius: 10px;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        thead {
            position: sticky;
            top: 0;
            z-index: 10;
            background: var(--qg-surface);
        }

        th {
            padding: 12px;
            text-align: left;
            font-weight: 700;
            font-size: 11px;
            color: var(--qg-cyan);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--qg-border);
            white-space: nowrap;
        }

        th:first-child {
            position: sticky;
            left: 0;
            z-index: 11;
            background: var(--qg-surface);
        }

        td {
            padding: 12px;
            border-bottom: 1px solid var(--qg-border);
            font-size: 12px;
        }

        td:first-child {
            position: sticky;
            left: 0;
            background: var(--qg-surface);
            font-weight: 700;
            z-index: 1;
        }

        tr:hover td {
            background: var(--qg-bg);
        }

        tr.updated td:first-child {
            border-left: 3px solid var(--warning);
        }

        .table-score-input {
            width: 55px;
            padding: 5px;
            border: 2px solid var(--qg-border);
            border-radius: 6px;
            text-align: center;
            font-size: 12px;
            font-weight: 700;
            background: var(--qg-bg);
            color: var(--qg-cyan);
        }

        .table-score-input:focus {
            outline: none;
            border-color: var(--qg-cyan);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.2);
        }

        /* Form */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 700;
            font-size: 12px;
            color: var(--qg-text);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid var(--qg-border);
            border-radius: 8px;
            font-size: 13px;
            background: var(--qg-bg);
            color: var(--qg-text);
            transition: all 0.3s;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--qg-cyan);
            box-shadow: 0 0 16px rgba(0, 212, 255, 0.2);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .form-hint {
            font-size: 11px;
            color: var(--qg-text-dim);
            margin-top: 4px;
        }

        /* Status Message */
        .status-msg {
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            margin-top: 12px;
            display: none;
            border: 1px solid;
            font-weight: 600;
        }

        .status-msg.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateY(-8px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .status-msg.success {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
            border-color: rgba(16, 185, 129, 0.3);
        }

        .status-msg.error {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
            border-color: rgba(239, 68, 68, 0.3);
        }

        .status-msg.info {
            background: rgba(0, 212, 255, 0.15);
            color: var(--qg-cyan);
            border-color: rgba(0, 212, 255, 0.3);
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid var(--qg-border);
            border-top-color: var(--qg-cyan);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--qg-text-dim);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .empty-state-text {
            font-size: 18px;
            font-weight: 700;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--qg-surface);
            border: 1px solid var(--qg-border);
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 24px var(--qg-shadow);
            z-index: 1000;
            display: none;
            animation: toastIn 0.3s ease-out;
        }

        @keyframes toastIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.show {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toast-icon {
            font-size: 20px;
        }

        .toast-message {
            font-size: 14px;
            font-weight: 600;
            color: var(--qg-text);
        }

        /* Shortcuts Hint */
        .shortcuts-hint {
            font-size: 11px;
            color: var(--qg-text-dim);
            text-align: center;
            padding: 8px;
            border-top: 1px solid var(--qg-border);
            margin-top: 12px;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            .header {
                padding: 24px;
            }
            .header-content {
                flex-direction: column;
                gap: 16px;
            }
            .brand-logo {
                font-size: 32px;
            }
            .brand-text h1 {
                font-size: 24px;
            }
            .stats-bar {
                grid-template-columns: 1fr;
            }
            .students-grid {
                grid-template-columns: 1fr;
            }
            .score-items {
                grid-template-columns: repeat(3, 1fr);
            }
            .toolbar {
                flex-direction: column;
            }
            .toolbar-section {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--qg-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--qg-border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--qg-cyan);
        }
    </style>
</head>
<body>
<div class="container">
    <header class="header">
        <div class="header-content">
            <div class="brand">
                <div class="brand-logo">ü§ñ</div>
                <div class="brand-text">
                    <h1>QG AI ËÆ≠ÁªÉËê•</h1>
                    <div class="subtitle">HOMEWORK MONITORING SYSTEM</div>
                </div>
            </div>
            <div class="theme-toggle" id="themeToggle">
                <span class="theme-icon">‚òÄÔ∏è</span>
                <span class="theme-text">Êòé‰∫ÆÊ®°Âºè</span>
            </div>
        </div>
    </header>

    <div class="stats-bar">
        <div class="stat-card">
            <div class="stat-content">
                <div class="stat-label">üìö Â≠¶ÂëòÊÄªÊï∞</div>
                <div class="stat-value" id="totalCount">0</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-content">
                <div class="stat-label">üîî Â∑≤Êõ¥Êñ∞</div>
                <div class="stat-value" id="updatedCount" style="background: linear-gradient(135deg, #f59e0b, #ef4444); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">0</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-content">
                <div class="stat-label">‚≠ê Âπ≥ÂùáÂàÜ</div>
                <div class="stat-value" id="avgScore" style="background: linear-gradient(135deg, #10b981, #34d399); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">0</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-content">
                <div class="stat-label">üïí ÂêåÊ≠•</div>
                <div class="stat-value" id="lastLoaded" style="font-size: 14px;">-</div>
            </div>
        </div>
    </div>

    <div class="toolbar">
        <div class="toolbar-section">
            <div class="view-switcher" id="viewSwitcher">
                <button class="view-btn active" data-view="card">üìá Âç°Áâá</button>
                <button class="view-btn" data-view="table">üìä Ë°®Ê†º</button>
            </div>
            <button id="checkBtn" class="btn btn-primary">
                <span>üîÑ</span> Ê£ÄÊü•Êõ¥Êñ∞
            </button>
            <button id="exportCsvBtn" class="btn btn-secondary">
                <span>üìä</span> ÂØºÂá∫CSV
            </button>
        </div>
        <div class="toolbar-section">
            <div class="toggle-wrapper">
                <span>‰ªÖÊòæÁ§∫Â∑≤Êõ¥Êñ∞</span>
                <div class="toggle" id="updatedOnlyToggle">
                    <div class="toggle-thumb"></div>
                </div>
            </div>
            <span style="font-size: 12px; color: var(--qg-text-dim);">
                Ëá™Âä®Âà∑Êñ∞: <strong id="refreshLabel" style="color: var(--qg-cyan);">60</strong>s
            </span>
        </div>
    </div>

    <div class="main-content">
        <div class="card">
            <div class="card-header">üìã Â≠¶Âëò‰Ωú‰∏öÂàóË°®</div>
            <div class="card-body">
                <div class="view-container">
                    <div class="view-wrapper" id="viewWrapper">
                        <div class="students-grid" id="cardView"></div>
                        <div class="table-view" id="tableView">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>ÂßìÂêç</th>
                                            <th>Áä∂ÊÄÅ</th>
                                            <th>ÊúÄÂêéÊõ¥Êñ∞</th>
                                            <th>ÊúÄÂêéÊü•Áúã</th>
                                            <th>Èò∂ÊÆµ1</th>
                                            <th>Èò∂ÊÆµ2</th>
                                            <th>Èò∂ÊÆµ3</th>
                                            <th>Èò∂ÊÆµ4</th>
                                            <th>Èò∂ÊÆµ5</th>
                                            <th>Âπ≥ÂùáÂàÜ</th>
                                            <th>Êìç‰Ωú</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <div class="card sidebar-card">
                <div class="card-header">üë§ Â≠¶ÂëòÁÆ°ÁêÜ</div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">ÂßìÂêç</label>
                        <input type="text" class="form-input" id="studentName" placeholder="Âº†‰∏â">
                    </div>
                    <div class="form-group">
                        <label class="form-label">‰ªìÂ∫ì</label>
                        <input type="url" class="form-input" id="studentRepo" placeholder="https://github.com/user/repo">
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button id="saveStudentBtn" class="btn btn-primary" style="flex: 1;">Êñ∞Â¢û</button>
                        <button id="cancelEditBtn" class="btn btn-ghost" style="display: none;">ÂèñÊ∂à</button>
                    </div>
                    <div id="studentStatus" class="status-msg"></div>
                    <div class="shortcuts-hint">üí° ÊèêÁ§∫ÔºöÂèåÂáªÂ≠¶ÂëòÂç°ÁâáÂø´ÈÄüÁºñËæë</div>
                </div>
            </div>

            <div class="card sidebar-card">
                <div class="card-header">üì• ÊâπÈáèÂØºÂÖ•</div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">Êï∞ÊçÆ</label>
                        <textarea class="form-textarea" id="importText" placeholder="ÂßìÂêç,ÈìæÊé•&#10;ÊàñÁõ¥Êé•Á≤òË¥¥ÈìæÊé•"></textarea>
                        <div class="form-hint">ÊîØÊåÅÈÄóÂè∑/Á©∫Ê†º/TabÂàÜÈöî</div>
                    </div>
                    <button id="importBtn" class="btn btn-success" style="width: 100%;">ÂØºÂÖ•</button>
                    <div id="importStatus" class="status-msg"></div>
                </div>
            </div>

            <div class="card sidebar-card">
                <div class="card-header">‚öôÔ∏è ËÆæÁΩÆ</div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">ÂâçÁ´ØÂà∑Êñ∞(Áßí)</label>
                        <input type="number" class="form-input" id="clientRefresh" min="5" max="3600" value="60">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÂêéÂè∞Ê£ÄÊü•(Áßí)</label>
                        <input type="number" class="form-input" id="serverPoll" min="5" max="3600" value="300">
                    </div>
                    <button id="saveSettingsBtn" class="btn btn-primary" style="width: 100%;">‰øùÂ≠ò</button>
                    <div id="settingsStatus" class="status-msg"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="toast" id="toast">
    <span class="toast-icon">‚úì</span>
    <span class="toast-message"></span>
</div>

<script>
const API = {
    LIST: '/api/list',
    CHECK: '/api/check',
    MARK: '/api/mark_viewed',
    SETTINGS: '/api/settings',
    IMPORT: '/api/students/import',
    ADD: '/api/students/add',
    UPDATE: '/api/students/update',
    DELETE: '/api/students/delete',
    SCORE: '/api/students/score',
    EXPORT: '/api/export/csv'
};

const PHASE_LABELS = ['Èò∂ÊÆµ1', 'Èò∂ÊÆµ2', 'Èò∂ÊÆµ3', 'Èò∂ÊÆµ4', 'Èò∂ÊÆµ5'];

let allRows = [];
let refreshTimer = null;
let editingStudent = null;
let currentView = 'card';
let currentTheme = 'light';

// Theme Toggle with Animation
function initTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    setTheme(savedTheme, false);
}

function setTheme(theme, animate = true) {
    currentTheme = theme;

    if (animate) {
        document.body.style.transition = 'none';
        document.documentElement.setAttribute('data-theme', theme);
        setTimeout(() => {
            document.body.style.transition = '';
        }, 50);
    } else {
        document.documentElement.setAttribute('data-theme', theme);
    }

    localStorage.setItem('theme', theme);

    const themeToggle = document.getElementById('themeToggle');
    const icon = themeToggle.querySelector('.theme-icon');
    const text = themeToggle.querySelector('.theme-text');

    if (theme === 'dark') {
        icon.textContent = 'üåô';
        text.textContent = 'Ê∑±Ëâ≤Ê®°Âºè';
    } else {
        icon.textContent = '‚òÄÔ∏è';
        text.textContent = 'Êòé‰∫ÆÊ®°Âºè';
    }
}

document.getElementById('themeToggle').addEventListener('click', () => {
    setTheme(currentTheme === 'light' ? 'dark' : 'light', true);
    showToast('‰∏ªÈ¢òÂ∑≤ÂàáÊç¢', '‚ú®');
});

// Toast Notification
function showToast(message, icon = '‚úì') {
    const toast = document.getElementById('toast');
    const iconEl = toast.querySelector('.toast-icon');
    const messageEl = toast.querySelector('.toast-message');

    iconEl.textContent = icon;
    messageEl.textContent = message;
    toast.classList.add('show');

    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// Utility Functions
function showStatus(elementId, message, type = 'info', duration = 3000) {
    const el = document.getElementById(elementId);
    if (!el) return;
    el.textContent = message;
    el.className = `status-msg show ${type}`;
    if (duration > 0) {
        setTimeout(() => {
            el.classList.remove('show');
        }, duration);
    }
}

function formatDate(dateStr) {
    if (!dateStr) return '-';
    try {
        const date = new Date(dateStr);
        const now = new Date();
        const diff = now - date;
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);

        if (minutes < 1) return 'ÂàöÂàö';
        if (minutes < 60) return `${minutes}ÂàÜÈíüÂâç`;
        if (hours < 24) return `${hours}Â∞èÊó∂Ââç`;
        if (days < 7) return `${days}Â§©Ââç`;

        return date.toLocaleString('zh-CN', {
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
        });
    } catch {
        return dateStr;
    }
}

function truncateUrl(url) {
    try {
        const urlObj = new URL(url);
        return urlObj.pathname.slice(1);
    } catch {
        return url;
    }
}

// Data Loading
async function fetchList() {
    try {
        const res = await fetch(API.LIST);
        if (!res.ok) throw new Error('Failed to fetch');
        allRows = await res.json();
        renderView();
        updateStats();
    } catch (e) {
        console.error('Failed to load data:', e);
        showToast('Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•', '‚ùå');
    }
}

function updateStats() {
    const total = allRows.length;
    const updated = allRows.filter(r => r.updated_since_view).length;
    const avgScore = total > 0 ? (allRows.reduce((sum, r) => sum + (r.avg_score || 0), 0) / total).toFixed(1) : '0';

    document.getElementById('totalCount').textContent = total;
    document.getElementById('updatedCount').textContent = updated;
    document.getElementById('avgScore').textContent = avgScore;
    document.getElementById('lastLoaded').textContent = new Date().toLocaleTimeString('zh-CN', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
}

function renderView() {
    if (currentView === 'card') {
        renderCardView();
    } else {
        renderTableView();
    }
}

function renderCardView() {
    const container = document.getElementById('cardView');
    container.innerHTML = '';

    const showUpdatedOnly = document.getElementById('updatedOnlyToggle').classList.contains('active');
    const filteredRows = showUpdatedOnly ? allRows.filter(r => r.updated_since_view) : allRows;

    if (filteredRows.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">üì≠</div>
                <div class="empty-state-text">ÊöÇÊó†Â≠¶ÂëòÊï∞ÊçÆ</div>
            </div>
        `;
        return;
    }

    filteredRows.forEach(row => {
        const scores = row.scores || [0, 0, 0, 0, 0];
        const avgScore = row.avg_score || 0;

        const card = document.createElement('div');
        card.className = `student-card ${row.updated_since_view ? 'updated' : ''}`;

        // ÂèåÂáªÁºñËæë
        card.addEventListener('dblclick', () => {
            editStudent(row.name);
            showToast('ËøõÂÖ•ÁºñËæëÊ®°Âºè', '‚úèÔ∏è');
        });

        const statusBadge = row.updated_since_view
            ? '<span class="badge badge-warning">üìå Â∑≤Êõ¥Êñ∞</span>'
            : '<span class="badge badge-success">‚úì Êó†Êõ¥Êñ∞</span>';

        const scoreInputsHtml = scores.map((score, index) => `
            <div class="score-item">
                <div class="score-item-label">${PHASE_LABELS[index]}</div>
                <input type="number" class="score-item-input"
                    data-name="${row.name}"
                    data-phase="${index}"
                    value="${score}"
                    min="0" max="100"
                    onchange="handleScoreChange(this)"
                    title="ÊåâEnter‰øùÂ≠ò">
            </div>
        `).join('');

        card.innerHTML = `
            <div class="student-card-header">
                <div>
                    <div class="student-name">${row.name || '-'}</div>
                    <a href="${row.repo}" target="_blank" class="student-repo-link" onclick="event.stopPropagation()">
                        üîó ${truncateUrl(row.repo)}
                    </a>
                </div>
                ${statusBadge}
            </div>

            <div class="student-meta">
                <div class="meta-item">
                    <div class="meta-label">ÊúÄÂêéÊõ¥Êñ∞</div>
                    <div class="meta-value">${formatDate(row.last_known_pushed_at)}</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">ÊúÄÂêéÊü•Áúã</div>
                    <div class="meta-value">${formatDate(row.last_viewed_at)}</div>
                </div>
            </div>

            <div class="student-scores">
                <div class="scores-header">
                    ‰∫îÈò∂ÊÆµËØÑÂàÜ
                    <span class="avg-score">${avgScore.toFixed(1)}</span>
                </div>
                <div class="score-items">
                    ${scoreInputsHtml}
                </div>
            </div>

            <div class="student-actions">
                <button class="btn btn-sm btn-primary" onclick="markViewed('${row.name}', '${row.repo}'); event.stopPropagation()">
                    üëÅÔ∏è Êü•Áúã
                </button>
                <button class="btn btn-sm btn-ghost" onclick="editStudent('${row.name}'); event.stopPropagation()">
                    ‚úèÔ∏è ÁºñËæë
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteStudent('${row.name}'); event.stopPropagation()">
                    üóëÔ∏è Âà†Èô§
                </button>
            </div>
        `;

        container.appendChild(card);
    });
}

function renderTableView() {
    const tbody = document.querySelector('#tableView tbody');
    tbody.innerHTML = '';

    const showUpdatedOnly = document.getElementById('updatedOnlyToggle').classList.contains('active');
    const filteredRows = showUpdatedOnly ? allRows.filter(r => r.updated_since_view) : allRows;

    if (filteredRows.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="11" style="text-align: center; padding: 40px; color: var(--qg-text-dim);">
                    ÊöÇÊó†Â≠¶ÂëòÊï∞ÊçÆ
                </td>
            </tr>
        `;
        return;
    }

    filteredRows.forEach(row => {
        const tr = document.createElement('tr');
        if (row.updated_since_view) tr.classList.add('updated');

        const scores = row.scores || [0, 0, 0, 0, 0];
        const statusBadge = row.updated_since_view
            ? '<span class="badge badge-warning">üìå Â∑≤Êõ¥Êñ∞</span>'
            : '<span class="badge badge-success">‚úì Êó†Êõ¥Êñ∞</span>';

        tr.innerHTML = `
            <td><strong>${row.name || '-'}</strong></td>
            <td>${statusBadge}</td>
            <td>${formatDate(row.last_known_pushed_at)}</td>
            <td>${formatDate(row.last_viewed_at)}</td>
            ${scores.map((score, index) => `
                <td>
                    <input type="number" class="table-score-input"
                        data-name="${row.name}"
                        data-phase="${index}"
                        value="${score}"
                        min="0" max="100"
                        onchange="handleScoreChange(this)">
                </td>
            `).join('')}
            <td><strong>${(row.avg_score || 0).toFixed(1)}</strong></td>
            <td>
                <div style="display: flex; gap: 4px;">
                    <button class="btn btn-sm btn-primary" onclick="markViewed('${row.name}', '${row.repo}')" title="Êü•Áúã‰ªìÂ∫ì">üëÅÔ∏è</button>
                    <button class="btn btn-sm btn-ghost" onclick="editStudent('${row.name}')" title="ÁºñËæë">‚úèÔ∏è</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteStudent('${row.name}')" title="Âà†Èô§">üóëÔ∏è</button>
                </div>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// Score Management
async function handleScoreChange(input) {
    const name = input.dataset.name;
    const phase = parseInt(input.dataset.phase);
    const score = Math.max(0, Math.min(100, parseInt(input.value) || 0));
    input.value = score;
    input.classList.add('changed');

    try {
        const res = await fetch(API.SCORE, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, phase, score })
        });

        const data = await res.json();
        if (res.ok && data.ok) {
            input.classList.remove('changed');
            const row = allRows.find(r => r.name === name);
            if (row) {
                row.scores[phase] = score;
                row.avg_score = row.scores.reduce((a, b) => a + b, 0) / 5;
                updateStats();
            }
            showToast(`${name} ${PHASE_LABELS[phase]} Â∑≤‰øùÂ≠ò`, '‚úì');
        } else {
            throw new Error('Save failed');
        }
    } catch (e) {
        input.classList.add('changed');
        showToast('‰øùÂ≠òÂ§±Ë¥•', '‚ùå');
    }
}

// Student Management
function editStudent(name) {
    const student = allRows.find(r => r.name === name);
    if (!student) return;

    editingStudent = name;
    document.getElementById('studentName').value = student.name;
    document.getElementById('studentRepo').value = student.repo;
    document.getElementById('saveStudentBtn').textContent = 'Êõ¥Êñ∞';
    document.getElementById('cancelEditBtn').style.display = 'block';

    document.querySelector('.main-content > div:last-child').scrollIntoView({
        behavior: 'smooth',
        block: 'start'
    });
}

function cancelEdit() {
    editingStudent = null;
    document.getElementById('studentName').value = '';
    document.getElementById('studentRepo').value = '';
    document.getElementById('saveStudentBtn').textContent = 'Êñ∞Â¢û';
    document.getElementById('cancelEditBtn').style.display = 'none';
    showToast('Â∑≤ÂèñÊ∂àÁºñËæë', '‚ÑπÔ∏è');
}

async function saveStudent() {
    const name = document.getElementById('studentName').value.trim();
    const repo = document.getElementById('studentRepo').value.trim();

    if (!name || !repo) {
        showStatus('studentStatus', 'ËØ∑Â°´ÂÜôÂßìÂêçÂíå‰ªìÂ∫ìÈìæÊé•', 'error');
        return;
    }

    const endpoint = editingStudent ? API.UPDATE : API.ADD;
    const payload = editingStudent
        ? { name, repo, old_name: editingStudent }
        : { name, repo };

    try {
        const res = await fetch(endpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        const data = await res.json();
        if (res.ok && data.ok) {
            showToast(editingStudent ? 'Â≠¶Âëò‰ø°ÊÅØÂ∑≤Êõ¥Êñ∞' : 'Â≠¶ÂëòÂ∑≤Ê∑ªÂä†', '‚úì');
            cancelEdit();
            await fetchList();
        } else {
            const errorMsg = data.error === 'name exists' ? 'ÂßìÂêçÂ∑≤Â≠òÂú®' :
                           data.error === 'repo exists' ? '‰ªìÂ∫ìÂ∑≤Â≠òÂú®' :
                           data.error === 'not found' ? 'Â≠¶Âëò‰∏çÂ≠òÂú®' : 'Êìç‰ΩúÂ§±Ë¥•';
            showStatus('studentStatus', errorMsg, 'error');
        }
    } catch (e) {
        showStatus('studentStatus', 'ÁΩëÁªúÈîôËØØ', 'error');
    }
}

async function deleteStudent(name) {
    if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§Â≠¶Âëò ${name} ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ`)) return;

    try {
        const res = await fetch(API.DELETE, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name })
        });

        const data = await res.json();
        if (res.ok && data.ok) {
            showToast('Â≠¶ÂëòÂ∑≤Âà†Èô§', '‚úì');
            if (editingStudent === name) cancelEdit();
            await fetchList();
        } else {
            showToast('Âà†Èô§Â§±Ë¥•', '‚ùå');
        }
    } catch (e) {
        showToast('ÁΩëÁªúÈîôËØØ', '‚ùå');
    }
}

// Actions
async function markViewed(name, repo) {
    window.open(repo, '_blank');
    try {
        await fetch(API.MARK, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name })
        });
        await fetchList();
        showToast(`Â∑≤Ê†áËÆ∞ ${name} ‰∏∫Â∑≤Êü•Áúã`, '‚úì');
    } catch (e) {
        console.error('Failed to mark as viewed:', e);
    }
}

async function checkNow() {
    const btn = document.getElementById('checkBtn');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner"></span> Ê£ÄÊü•‰∏≠...';

    try {
        await fetch(API.CHECK, { method: 'POST' });
        await fetchList();
        showToast('Ê£ÄÊü•ÂÆåÊàê', '‚úì');
    } catch (e) {
        console.error('Check failed:', e);
        showToast('Ê£ÄÊü•Â§±Ë¥•', '‚ùå');
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<span>üîÑ</span> Ê£ÄÊü•Êõ¥Êñ∞';
    }
}

async function exportCsv() {
    try {
        const res = await fetch(API.EXPORT);
        if (!res.ok) throw new Error('Export failed');

        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `students_scores_${new Date().toISOString().slice(0,10)}.csv`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);

        showToast('CSVÂ∑≤ÂØºÂá∫', 'üìä');
    } catch (e) {
        showToast('ÂØºÂá∫Â§±Ë¥•', '‚ùå');
    }
}

async function importStudents() {
    const text = document.getElementById('importText').value.trim();
    if (!text) {
        showStatus('importStatus', 'ËØ∑ËæìÂÖ•Ë¶ÅÂØºÂÖ•ÁöÑÂÜÖÂÆπ', 'error');
        return;
    }

    try {
        const res = await fetch(API.IMPORT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text })
        });

        const data = await res.json();
        if (res.ok && data.ok) {
            showToast(`ÂØºÂÖ•ÂÆåÊàêÔºöÊñ∞Â¢û${data.added}‰∏™ÔºåÊõ¥Êñ∞${data.updated}‰∏™`, '‚úì');
            document.getElementById('importText').value = '';
            await fetchList();
        } else {
            showStatus('importStatus', 'ÂØºÂÖ•Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Ê†ºÂºè', 'error');
        }
    } catch (e) {
        showStatus('importStatus', 'ÁΩëÁªúÈîôËØØ', 'error');
    }
}

async function saveSettings() {
    const clientRefresh = parseInt(document.getElementById('clientRefresh').value);
    const serverPoll = parseInt(document.getElementById('serverPoll').value);

    try {
        const res = await fetch(API.SETTINGS, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                client_refresh_seconds: clientRefresh,
                server_poll_interval_seconds: serverPoll
            })
        });

        const data = await res.json();
        if (res.ok && data.ok) {
            showToast('ËÆæÁΩÆÂ∑≤‰øùÂ≠ò', '‚úì');
            setRefreshInterval(data.settings.client_refresh_seconds);
        } else {
            showToast('‰øùÂ≠òÂ§±Ë¥•', '‚ùå');
        }
    } catch (e) {
        showToast('ÁΩëÁªúÈîôËØØ', '‚ùå');
    }
}

async function loadSettings() {
    try {
        const res = await fetch(API.SETTINGS);
        const settings = await res.json();
        document.getElementById('clientRefresh').value = settings.client_refresh_seconds;
        document.getElementById('serverPoll').value = settings.server_poll_interval_seconds;
        setRefreshInterval(settings.client_refresh_seconds);
    } catch (e) {
        console.error('Failed to load settings:', e);
    }
}

function setRefreshInterval(seconds) {
    document.getElementById('refreshLabel').textContent = seconds;
    if (refreshTimer) clearInterval(refreshTimer);
    refreshTimer = setInterval(fetchList, seconds * 1000);
}

// View Switching
document.querySelectorAll('.view-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const view = this.dataset.view;
        if (view === currentView) return;

        currentView = view;
        const viewWrapper = document.getElementById('viewWrapper');
        const viewSwitcher = document.getElementById('viewSwitcher');

        document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');

        if (view === 'table') {
            viewSwitcher.classList.add('table-active');
            viewWrapper.classList.add('flipping');
            renderTableView();
            showToast('ÂàáÊç¢Âà∞Ë°®Ê†ºËßÜÂõæ', 'üìä');
        } else {
            viewSwitcher.classList.remove('table-active');
            viewWrapper.classList.remove('flipping');
            showToast('ÂàáÊç¢Âà∞Âç°ÁâáËßÜÂõæ', 'üìá');
        }
    });
});

// Event Listeners
document.getElementById('checkBtn').addEventListener('click', checkNow);
document.getElementById('exportCsvBtn').addEventListener('click', exportCsv);
document.getElementById('saveStudentBtn').addEventListener('click', saveStudent);
document.getElementById('cancelEditBtn').addEventListener('click', cancelEdit);
document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
document.getElementById('importBtn').addEventListener('click', importStudents);

document.getElementById('updatedOnlyToggle').addEventListener('click', function() {
    this.classList.toggle('active');
    renderView();
    const isActive = this.classList.contains('active');
    showToast(isActive ? '‰ªÖÊòæÁ§∫Â∑≤Êõ¥Êñ∞' : 'ÊòæÁ§∫ÂÖ®ÈÉ®Â≠¶Âëò', '‚ÑπÔ∏è');
});

// Keyboard Shortcuts
document.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        checkNow();
    }
    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
        e.preventDefault();
        exportCsv();
    }
    if ((e.ctrlKey || e.metaKey) && e.key === '/') {
        e.preventDefault();
        document.getElementById('themeToggle').click();
    }
});

// Initialize
initTheme();
loadSettings();
fetchList();

setTimeout(() => {
    showToast('Ê¨¢Ëøé‰ΩøÁî® QG AI ËÆ≠ÁªÉËê•ÁõëÊéßÁ≥ªÁªü', 'üëã');
}, 500);
</script>
</body>
</html>

